<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Global Movie chat</title>

    <link rel="stylesheet" href="/static/css/chat.css">
</head>
<body>
    <div class="chat-container">
        <div class="chat-header">
            <div class="bubble">
                &#127916 Movie Assistant
            </div>
            
        </div>

        <div id="chat-messages" class="chat-messages">
            <div class="message bot">
                <div class="bubble" >
                    Hi &#128075 Ask me about movies, genres, or recommendations.
                </div>
            </div>
        </div>
        <div class="chat-input">
            <input type="text" id="chat-input" placeholder="ASk about movies...">
                <button onclick="sendMessage()">Send</button>
        </div>

    </div>
    <script>
        async function sendMessage(){
            const input = document.getElementById("chat-input");
            const message = input.value.trim();
            if(!message) return;

            const chatBox = document.getElementById("chat-messages")

            chatBox.innerHTML +=`
                <div class="message user">
                    <div class="bubble">${message}</div>
                </div>
            `
            ;
            input.value = "";
            chatBox.scrollTop = chatBox.scrollHeight;

            const boltd = "bot-" + Date.now();
            chatBox.innerHTML +=`
                <div class="message bot" id="${boltd}">
                    <div class="bubble"> Thinking...</div>
                </div>
            `
            ;

            chatBox.scrollTop = chatBox.scrollHeight;

            try {
                const response = await fetch("/chat/global", {
                    method:"POST",
                    headers: {"Content-Type":"application/json"},
                    body:JSON.stringify({message: message})
                });
                const data = await response.json();
                document.getElementById(boltd).innerHTML =`
                    <div class="bubble"> ${data.answer} </div>
                `
                ;


            } catch {
                document.getElementById(boltd).innerHTML =`
                    <div class="bubble"> Error connecting to assistant </div>
                `
                ;
            }
            chatBox.scrollTop = chatBox.scrollHeight;
            
        }

    document.getElementById("chat-input").addEventListener("keydown",function (e) {
        if (e.key === "Enter") sendMessage();
    });
    </script>
</body>
</html>